<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
  <meta charset="UTF-8">
  <title>공연 목록 조회</title>
  <link rel="stylesheet"
        href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css">
  <script src="https://code.jquery.com/jquery-3.5.1.min.js"></script>
</head>
<body>
<div class="container mt-4">
  <h1 class="text-center mb-4">공연 목록 조회</h1>

  <!-- 필터 영역 -->
  <form id="filterForm" class="mb-4">
    <div class="form-check form-check-inline">
      <input class="form-check-input" type="radio" name="filter" id="latest" value="latest" checked>
      <label class="form-check-label" for="latest">최신순</label>
    </div>
    <div class="form-check form-check-inline">
      <input class="form-check-input" type="radio" name="filter" id="likes" value="likes">
      <label class="form-check-label" for="likes">좋아요순</label>
    </div>
    <div class="form-check form-check-inline">
      <input class="form-check-input" type="radio" name="filter" id="category" value="category">
      <label class="form-check-label" for="category">카테고리</label>
      <select id="categorySelect" class="ml-2" style="display: block;">
        <option th:each="category : ${categories}" th:value="${category}" th:text="${category}">선택
        </option>
      </select>
    </div>
    <div class="form-check form-check-inline">
      <input class="form-check-input" type="radio" name="filter" id="custom" value="custom">
      <label class="form-check-label" for="custom">사용자 지정</label>
    </div>

    <!-- 사용자 지정 필터용 날짜 -->
    <div id="customDateFields" class="mt-2" style="display: none;">
      <label>시작 시간:
        <input type="datetime-local" id="startDate" name="startDate"
               class="form-control d-inline-block w-auto ml-1">
      </label>
      <label class="ml-3">종료 시간:
        <input type="datetime-local" id="endDate" name="endDate"
               class="form-control d-inline-block w-auto ml-1">
      </label>
    </div>

    <button type="submit" class="btn btn-primary mt-3">조회</button>
  </form>

  <!-- 공연 목록 테이블 -->
  <table class="table table-striped">
    <thead>
    <tr>
      <th scope="col">Image</th>
      <th scope="col">Title</th>
      <th scope="col">Place</th>
      <th scope="col">Start Time</th>
      <th scope="col">End Time</th>
      <th scope="col">Category</th>
      <th scope="col">Reservation Time</th>
    </tr>
    </thead>
    <tbody>
    <tr th:each="performance : ${performances}">
      <td>
        <img th:src="@{/image/{fileName}(fileName=${performance.file.fileName})}"
             alt="no image"
             style="width: 100px; height: auto; object-fit: cover;"/>
      </td>
      <td th:text="${performance.title}"></td>
      <td th:text="${performance.place.name}"></td>
      <td th:text="${performance.startTime}"></td>
      <td th:text="${performance.endTime}"></td>
      <td th:text="${performance.category.name}"></td>
      <td th:text="${performance.reservationStartTime}"></td>
    </tr>
    </tbody>
  </table>
</div>

<script>
  // 필터 선택 시 UI 토글
  $("input[name='filter']").on("change", function () {
    const selected = $(this).val();
    $("#customDateFields").hide();
    $("#categorySelect").hide();

    if (selected === "custom") {
      $("#customDateFields").show();
    } else if (selected === "category") {
      $("#categorySelect").show();
    }
  });

  // 폼 전송 시 URL 이동
  $("#filterForm").on("submit", function (e) {
    e.preventDefault();

    const selected = $("input[name='filter']:checked").val();
    let url = "/performances?";
    if (selected === "latest" || selected === "likes") {
      url += `sort=${selected}`;
    } else if (selected === "custom") {
      const startDate = $("#startDate").val();
      const endDate = $("#endDate").val();
      if (!startDate || !endDate) {
        alert("시작 시간과 종료 시간을 모두 입력하세요.");
        return;
      }
      url += `startDate=${encodeURIComponent(startDate)}&endDate=${encodeURIComponent(endDate)}`;
    } else if (selected === "category") {
      const category = $("#categorySelect").val();
      url += `category=${category}`;
    }
    location.href = url;
  });
</script>

<script src="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/js/bootstrap.min.js"></script>
</body>
</html>
